'use strict';
var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
};
var utils_1 = require('./utils');
var debug = require('debug')('packet-frame:magic');
var SizeOffset = function (size, offset) {
    return function (target, propertyKey, descriptor) {
        var sizes = {
            size: size,
            offset: offset
        };
        if (!('_sizes' in target)) {
            target['_sizes'] = {};
        }
        target['_sizes'][propertyKey] = sizes;
        return descriptor;
    };
};
var Magic = (function () {
    function Magic(debug, magicVersion) {
        var _this = this;
        if (debug === void 0) { debug = false; }
        if (magicVersion === void 0) { magicVersion = 0x02; }
        this.debug = debug;
        this.magicVersion = magicVersion;
        this.sizeofHeader = 0;
        this.MAX_SIZE = 0;
        this.sizeofHeader = (function () {
            var total = 0;
            for (var i in _this._sizes) {
                total += _this._sizes[i].size;
            }
            return total;
        })();
        this.MAX_SIZE = (function () {
            return _this.sizeofHeader + Math.pow(2, _this._sizes['size'].size * 8);
        })();
    }
    Magic.prototype.getOffset = function (buffer, offset) {
        if (buffer.markedOffset > -1) {
            return buffer.markedOffset + offset;
        }
        else {
            return offset;
        }
    };
    Magic.prototype.version = function (buffer, version) {
        var offset = this._sizes['version'].offset;
        buffer.offset += this._sizes['version'].size;
        if (version !== void 0) {
            version = version === true ? this.magicVersion : version;
            buffer.writeUint8(version, offset);
            return version;
        }
        else {
            try {
                return buffer.readUint8(this.getOffset(buffer, offset));
            }
            catch (e) {
                /*istanbul ignore next:not needed to be tested*/
                if (this.debug) {
                    throw e;
                }
            }
            return null;
        }
    };
    /**
     * Compare the versions
     */
    Magic.prototype.checkVersion = function (buffer, version) {
        return this.version(buffer) === (version || this.magicVersion);
    };
    Magic.prototype.dataChecksum = function (buffer, data, length) {
        var offset = this._sizes['dataChecksum'].offset;
        buffer.offset += this._sizes['dataChecksum'].size;
        if (data !== void 0) {
            var hash = utils_1._quickCRC32(data, length);
            buffer.writeUint32(hash, offset);
            return hash;
        }
        else {
            try {
                return buffer.readUint32(this.getOffset(buffer, offset));
            }
            catch (e) {
                /*istanbul ignore next:not needed to be tested*/
                if (this.debug) {
                    throw e;
                }
            }
            return null;
        }
    };
    Magic.prototype.checkDataCS = function (buffer, len, chksum) {
        var length = len || this.size(buffer);
        if (!length || length > (buffer && buffer.limit)) {
            return null;
        }
        var data;
        try {
            data = buffer.readBytes(length, this.getOffset(buffer, this.sizeofHeader));
        }
        catch (e) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                throw e;
            }
            return null;
        }
        return utils_1._quickCRC32(data, len, chksum || this.dataChecksum(buffer, null, len)) && data;
    };
    Magic.prototype.size = function (buffer, length) {
        var offset = this._sizes['size'].offset;
        buffer.offset += this._sizes['size'].size;
        if (length !== void 0) {
            buffer.writeUint16(length, offset);
            return length;
        }
        else {
            try {
                return buffer.readUint16(this.getOffset(buffer, offset));
            }
            catch (e) {
                /*istanbul ignore next:not needed to be tested*/
                if (this.debug) {
                    throw e;
                }
            }
            return null;
        }
    };
    Magic.prototype.headerChecksum = function (buffer, header) {
        var offset = this._sizes['headerChecksum'].offset;
        buffer.offset += this._sizes['headerChecksum'].size;
        if (header) {
            var len = this.sizeofHeader - this._sizes['headerChecksum'].size;
            var hash = utils_1._quickCRC32(header.readBytes(len, 0), len);
            buffer.writeUint32(hash, offset);
            return hash;
        }
        else {
            try {
                return buffer.readUint32(this.getOffset(buffer, offset));
            }
            catch (e) {
                /*istanbul ignore next:not needed to be tested*/
                if (this.debug) {
                    throw e;
                }
            }
            return null;
        }
    };
    Magic.prototype.checkHeaderCS = function (buffer, chksum) {
        var header;
        try {
            var len = this.sizeofHeader - this._sizes['headerChecksum'].size;
            header = buffer.readBytes(len, this.getOffset(buffer, 0));
        }
        catch (e) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                throw e;
            }
            return null;
        }
        return utils_1._quickCRC32(header, header.limit, chksum || this.headerChecksum(buffer));
    };
    Magic.prototype.payload = function (buffer, data, length) {
        var offset = this.sizeofHeader;
        length = length || (data && data.length);
        try {
            if (this.size(buffer, length)) {
                buffer.offset += length;
                buffer.append(data, offset);
            }
            else {
                return null;
            }
        }
        catch (e) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                throw e;
            }
            return null;
        }
        return length;
    };
    Magic.prototype.getAll = function (buffer) {
        var version = this.version(buffer);
        if (version !== this.magicVersion) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                buffer.printDebug();
                throw new Error('Version mismatch ' + version + ' != ' + this.magicVersion);
            }
            return null;
        }
        var headerChecksum = this.headerChecksum(buffer);
        if (!this.checkHeaderCS(buffer, headerChecksum)) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                buffer.printDebug();
                throw new Error('Invalid header checksum ' + headerChecksum);
            }
            return null;
        }
        var size = this.size(buffer);
        if (!size) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                buffer.printDebug();
                throw new Error('Invalid length ' + size);
            }
            return null;
        }
        var dataChecksum = this.dataChecksum(buffer, null, size);
        if (!dataChecksum) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                buffer.printDebug();
                throw new Error('Invalid data checksum ' + dataChecksum);
            }
            return null;
        }
        var data = this.checkDataCS(buffer, size, dataChecksum);
        if (!data) {
            /*istanbul ignore next:not needed to be tested*/
            if (this.debug) {
                buffer.printDebug();
                throw new Error('Invalid data');
            }
            return null;
        }
        return {
            version: version,
            dataChecksum: dataChecksum,
            headerChecksum: headerChecksum,
            size: size,
            data: data
        };
    };
    Magic.prototype.setAll = function (dataBuffer, data, length) {
        if (!data || !dataBuffer) {
            throw new Error('Empty data');
        }
        if ((length || data.length) > this.MAX_SIZE) {
            throw new Error('Packet MAX_SIZE is ' + this.MAX_SIZE + ' bytes');
        }
        if ((length || data.length) <= 0) {
            throw new Error('Invalid data length of ' + (length || data.length) + ' bytes');
        }
        dataBuffer.mark(0).reset();
        var version = this.version(dataBuffer, true);
        var dataChecksum = this.dataChecksum(dataBuffer, data, length);
        var size = this.payload(dataBuffer, data, length);
        var headerChecksum = this.headerChecksum(dataBuffer, dataBuffer);
        dataBuffer.compact();
        return {
            version: version,
            dataChecksum: dataChecksum,
            size: size,
            headerChecksum: headerChecksum
        };
    };
    __decorate([
        SizeOffset(1, 0)
    ], Magic.prototype, "version", null);
    __decorate([
        SizeOffset(4, 1)
    ], Magic.prototype, "dataChecksum", null);
    __decorate([
        SizeOffset(2, 5)
    ], Magic.prototype, "size", null);
    __decorate([
        SizeOffset(4, 7)
    ], Magic.prototype, "headerChecksum", null);
    return Magic;
})();
exports.Magic = Magic;
exports.instance = new Magic();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFnaWMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvbWFnaWMudHMiXSwibmFtZXMiOlsiTWFnaWMiLCJNYWdpYy5jb25zdHJ1Y3RvciIsIk1hZ2ljLmdldE9mZnNldCIsIk1hZ2ljLnZlcnNpb24iLCJNYWdpYy5jaGVja1ZlcnNpb24iLCJNYWdpYy5kYXRhQ2hlY2tzdW0iLCJNYWdpYy5jaGVja0RhdGFDUyIsIk1hZ2ljLnNpemUiLCJNYWdpYy5oZWFkZXJDaGVja3N1bSIsIk1hZ2ljLmNoZWNrSGVhZGVyQ1MiLCJNYWdpYy5wYXlsb2FkIiwiTWFnaWMuZ2V0QWxsIiwiTWFnaWMuc2V0QWxsIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7Ozs7QUFFYixzQkFBNEIsU0FBUyxDQUFDLENBQUE7QUFHdEMsSUFBSSxLQUFLLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLG9CQUFvQixDQUFDLENBQUM7QUFlbkQsSUFBSSxVQUFVLEdBQUcsVUFBUyxJQUFZLEVBQUUsTUFBYztJQUNsRCxNQUFNLENBQUMsVUFBYSxNQUFXLEVBQUUsV0FBNEIsRUFBRSxVQUFzQztRQUNqRyxJQUFJLEtBQUssR0FBVTtZQUNmLElBQUksRUFBRSxJQUFJO1lBQ1YsTUFBTSxFQUFFLE1BQU07U0FDakIsQ0FBQztRQUVGLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLElBQUksTUFBTSxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBQ3hCLE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxFQUFFLENBQUE7UUFDekIsQ0FBQztRQUVELE1BQU0sQ0FBQyxRQUFRLENBQUMsQ0FBQyxXQUFXLENBQUMsR0FBRyxLQUFLLENBQUM7UUFFdEMsTUFBTSxDQUFDLFVBQVUsQ0FBQztJQUN0QixDQUFDLENBQUE7QUFDTCxDQUFDLENBQUE7QUFFRDtJQUtJQSxlQUFtQkEsS0FBc0JBLEVBQVNBLFlBQTJCQTtRQUxqRkMsaUJBNFFDQTtRQXZRZUEscUJBQTZCQSxHQUE3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QkE7UUFDbERRLElBQUlBLE1BQU1BLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsTUFBTUEsQ0FBQ0E7UUFDbERBLE1BQU1BLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0E7UUFDcERBLEVBQUVBLENBQUNBLENBQUNBLE1BQU1BLENBQUNBLENBQUNBLENBQUNBO1lBQ1RBLElBQUlBLEdBQUdBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLGdCQUFnQkEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0E7WUFDakVBLElBQUlBLElBQUlBLEdBQUdBLG1CQUFXQSxDQUFDQSxNQUFNQSxDQUFDQSxTQUFTQSxDQUFDQSxHQUFHQSxFQUFFQSxDQUFDQSxDQUFDQSxFQUFFQSxHQUFHQSxDQUFDQSxDQUFDQTtZQUN0REEsTUFBTUEsQ0FBQ0EsV0FBV0EsQ0FBQ0EsSUFBSUEsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0E7WUFDakNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBO1FBQ2hCQSxDQUFDQTtRQUFDQSxJQUFJQSxDQUFDQSxDQUFDQTtZQUNKQSxJQUFJQSxDQUFDQTtnQkFDREEsTUFBTUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsVUFBVUEsQ0FBQ0EsSUFBSUEsQ0FBQ0EsU0FBU0EsQ0FBQ0EsTUFBTUEsRUFBRUEsTUFBTUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDN0RBLENBQUVBO1lBQUFBLEtBQUtBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO2dCQUNUQSxnREFBZ0RBO2dCQUNoREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsSUFBSUEsQ0FBQ0EsS0FBS0EsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7b0JBQ2JBLE1BQU1BLENBQUNBLENBQUNBO2dCQUNaQSxDQUFDQTtZQUNMQSxDQUFDQTtZQUNEQSxNQUFNQSxDQUFDQSxJQUFJQSxDQUFD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LENBQUNBLENBQUNBLElBQUlBLElBQUlBLENBQUNBLFVBQVVBLENBQUNBLENBQUNBLENBQUNBO1lBQ3ZCQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSxZQUFZQSxDQUFDQSxDQUFDQTtRQUNsQ0EsQ0FBQ0E7UUFFREEsRUFBRUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0EsTUFBTUEsSUFBSUEsSUFBSUEsQ0FBQ0EsTUFBTUEsQ0FBQ0EsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsQ0FBQ0EsQ0FBQ0EsQ0FBQ0E7WUFDMUNBLE1BQU1BLElBQUlBLEtBQUtBLENBQUNBLHFCQUFxQkEsR0FBR0EsSUFBSUEsQ0FBQ0EsUUFBUUEsR0FBR0EsUUFBUUEsQ0FBQ0EsQ0FBQ0E7UUFDdEVBLENBQUNBO1FBRURBLEVBQUVBLENBQUNBLENBQUNBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLElBQUlBLENBQUNBLENBQUNBLENBQUNBLENBQUNBO1lBQy9CQSxNQUFNQSxJQUFJQSxLQUFLQSxDQUFDQSx5QkFBeUJBLEdBQUdBLENBQUNBLE1BQU1BLElBQUlBLElBQUlBLENBQUNBLE1BQU1BLENBQUNBLEdBQUdBLFFBQVFBLENBQUNBLENBQUNBO1FBQ3BGQSxDQUFDQTtRQUVEQSxVQUFVQSxDQUFDQSxJQUFJQSxDQUFDQSxDQUFDQSxDQUFDQSxDQUFDQSxLQUFLQSxFQUFFQSxDQUFDQTtRQUUzQkEsSUFBSUEsT0FBT0EsR0FBR0EsSUFBSUEsQ0FBQ0EsT0FBT0EsQ0FBQ0EsVUFBVUEsRUFBRUEsSUFBSUEsQ0FBQ0EsQ0FBQ0E7UUFDN0NBLElBQUlBLFlBQVlBLEdBQUdBLElBQUlBLENBQUNBLFlBQVlBLENBQUNBLFVBQVVBLEVBQUVBLElBQUlBLEVBQUVBLE1BQU1BLENBQUNBLENBQUNBO1FBQy9EQSxJQUFJQSxJQUFJQSxHQUFHQSxJQUFJQSxDQUFDQSxPQUFPQSxDQUFDQSxVQUFVQSxFQUFFQSxJQUFJQSxFQUFFQSxNQUFNQSxDQUFDQSxDQUFDQTtRQUNsREEsSUFBSUEsY0FBY0EsR0FBR0EsSUFBSUEsQ0FBQ0EsY0FBY0EsQ0FBQ0EsVUFBVUEsRUFBRUEsVUFBVUEsQ0FBQ0EsQ0FBQ0E7UUFFakVBLFVBQVVBLENBQUNBLE9BQU9BLEVBQUVBLENBQUNBO1FBRXJCQSxNQUFNQSxDQUFDQTtZQUNIQSxPQUFPQSxFQUFVQSxPQUFPQTtZQUN4QkEsWUFBWUEsRUFBRUEsWUFBWUE7WUFDMUJBLElBQUlBLEVBQUVBLElBQUlBO1lBQ1ZBLGNBQWNBLEVBQUVBLGNBQWNBO1NBQ2pDQSxDQUFDQTtJQUNOQSxDQUFDQTtJQS9PRFo7UUFBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7T0FDakJBLDBCQUFPQSxRQWtCTkE7SUFTREE7UUFBQ0EsVUFBVUEsQ0FBQ0EsQ0FBQ0EsRUFBRUEsQ0FBQ0EsQ0FBQ0E7T0FDakJBLCtCQUFZQSxRQW1CWEE7SUFxQkRBO1FBQUNBLFVBQVVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO09BQ2pCQSx1QkFBSUEsUUFpQkhBO0lBRURBO1FBQUNBLFVBQVVBLENBQUNBLENBQUNBLEVBQUVBLENBQUNBLENBQUNBO09BQ2pCQSxpQ0FBY0EsUUFtQmJBO0lBbUlMQSxZQUFDQTtBQUFEQSxDQUFDQSxBQTVRRCxJQTRRQztBQTVRWSxhQUFLLFFBNFFqQixDQUFBO0FBRVUsZ0JBQVEsR0FBRyxJQUFJLEtBQUssRUFBRSxDQUFDIn0=